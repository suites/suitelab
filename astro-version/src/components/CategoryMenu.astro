---
import { CATEGORIES } from '@/consts';
import type { Category } from '@/consts';

const currentPath = Astro.url.pathname;

// 현재 활성 카테고리 확인
function isActiveCategory(category: Category): boolean {
  return currentPath.startsWith(`/category/${category.slug}`);
}

// 홈 활성화 확인
const isHome = currentPath === '/';

// 카테고리별 선인장 SVG 매핑
const cactusIcons: Record<string, string> = {
  'web': '/images/svg/categories/cactus-blue.svg',
  'network': '/images/svg/categories/cactus-green.svg', 
  'cs': '/images/svg/categories/cactus-yellow.svg',
  'algorithm': '/images/svg/categories/cactus-blue.svg',
  'deep-learning': '/images/svg/categories/cactus-green.svg',
  'infrastructure': '/images/svg/categories/cactus-red.svg',
  'infra': '/images/svg/categories/cactus-red.svg',
};
---

<nav class="category-menu" aria-label="카테고리 네비게이션">
  <ul class="category-list">
    <!-- 홈 (New) -->
    <li class="category-item">
      <a 
        href="/"
        class={`category-link ${isHome ? 'active' : ''}`}
        aria-current={isHome ? 'page' : undefined}
      >
        <div class="category-image">
          <img src="/images/svg/categories/new.svg" alt="새 글" />
        </div>
        <span class="category-name">new</span>
      </a>
    </li>
    
    <!-- 카테고리 목록 -->
    {CATEGORIES.map((category) => (
      <li class="category-item">
        <a 
          href={category.link}
          class={`category-link ${isActiveCategory(category) ? 'active' : ''}`}
          aria-current={isActiveCategory(category) ? 'page' : undefined}
        >
          <div class="category-image">
            <img 
              src={cactusIcons[category.slug] || '/images/svg/categories/cactus-blue.svg'} 
              alt={category.name}
              class="cactus"
            />
          </div>
          <span class="category-name">
            {category.name}
          </span>
        </a>
      </li>
    ))}
  </ul>
</nav>

<style>
                .category-menu {
                display: block;
                margin: 0;
                padding: 0 0 2em;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
              }
              
              .category-menu::-webkit-scrollbar {
                display: none;
              }
  
  .category-list {
    display: flex;
    flex-wrap: nowrap;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 20px;
  }
  
  .category-item {
    flex-shrink: 0;
    width: 70px;
    text-align: center;
  }
  
  .category-link {
    display: block;
    color: white;
    text-decoration: none;
  }
  
  .category-image {
    padding: 2px;
    background: rgba(49, 55, 70, 0.5);
    border-radius: 50%;
    position: relative;
    margin-bottom: 5px;
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .category-image img {
    position: relative;
    background: rgba(49, 55, 70, 0.5);
    border-radius: 50%;
    display: block;
    width: 66px;
    height: 66px;
    z-index: 2;
    object-fit: cover;
  }
  
  .category-name {
    margin-top: 5px;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: rgba(255, 255, 255, 0.6);
    display: block;
  }
  
  /* Active state with animation */
  .category-item.active .category-image::after,
  .category-link.active .category-image::after {
    content: '';
    position: absolute;
    display: block;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(-45deg, #ffa649, #f7645b, #805ed4);
    animation: rotating 2s linear infinite;
  }
  
  .category-item.active img,
  .category-link.active img {
    border: solid 2px rgb(33, 36, 45);
  }
  
  .category-item.active .category-name,
  .category-link.active .category-name {
    color: white;
  }
  
  @keyframes rotating {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  
  @media screen and (max-width: 500px) { /* theme.responsive.small */
    .category-menu {
      padding: 1em 0;
      margin: 0 -20px;
      -webkit-overflow-scrolling: touch;
    }
    
    .category-menu::-webkit-scrollbar {
      display: none;
    }
    
    .category-list::after {
      content: '';
      width: 40px;
      flex: 0 0 auto;
    }
    
    .category-item {
      width: 60px;
      margin: 0 0 0 15px;
      flex: 0 0 auto;
    }
    
    .category-item .category-image {
      width: 60px;
      height: 60px;
    }
    
    .category-item .category-image img {
      width: 56px;
      height: 56px;
    }
    
    .category-name {
      font-size: 12px;
    }
  }
</style>